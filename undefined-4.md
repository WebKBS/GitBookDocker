# 네트워크 통신 도커화

(node 기준) node로만 개발하여 HTTP요청을 외부 api와 통신하면 이는 정상적으로 작동한다.

node로 만든 앱을 도커화 하여 이미지로 만든 후 빌드를 하더라도 이는 정상적으로 작동한다.

이미지를 만들때 node를 복사하기때문에 외부 통신에는 전혀 문제가 없다.



## 로컬 호스트와의 통신

만약 node의 코드중 로컬의 데이터베이스와 통신하는 로직이 있다면 이는 문제가 생긴다.

왜냐하면 node의 복사된 이미지는 컨테이너에서 실행중이고, 로컬의 데이터베이스는 로컬에서 실행되기 때문이다. (데이터베이스가 로컬 호스트 localhost:3000으로 사용된 가정)

도커는 컨테이너에서 실행중인 이미지가 로컬 호스트와 네트워크 통신을 하지않는다.

node에 로컬호스트와 통신하기 위한 코드가 있다면 docker run, 컨테이너 실행부터 에러가 난다.



이를 해결하기 위해서 node에 작성된 데이터베이스 url을 수정해줘야 한다.

만약 아래처럼 로컬에서 실행된 mongodb의 url이라고 가정하자.

```javascript
mongoose.connect("mongodb://localhost:27017/fwefwef")
```

위처럼 localhost:27012로 로컬에서 실행된 주소를 아래처럼 변경해주자.

localhost:3000가 아닌 host.docker.internal

```javascript
mongoose.connect("mongodb://host.docker.internal/fwefwef")
```

이는 도커 컨테이너 내부에서 알 수 있는 호스트 머신 ip주소로 변환된다.

이후 docker 이미지를 다시 빌드 한 후 컨테이너를 실행하면 정상적으로 작동 된다.











데이터베이스와 통신하려면 로컬에서 해당 데이터베이스를 설치를 해야한다.

이를 도커화를 진행함으로 있어서 데이터베이스를 로컬에 설치 않고 도커를 사용해서 실행 해보자.



{% hint style="info" %}
데이터베이스를 사용하려면 백엔드 이미지와 별개로 따로 이미지를 만들어야한다!
{% endhint %}





